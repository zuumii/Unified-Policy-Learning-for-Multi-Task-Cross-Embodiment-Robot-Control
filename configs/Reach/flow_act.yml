# ===== Flow Matching 先验预训练（Actions）=====
expert_folder: human_demonstrations   # 数据根目录（统一入口）

# 源/目标定义：任务名和机器人名应记录清楚（与 align 的 src_env/tgt_env 对齐）
task_name: Reach
env_name: Reach
seed: 42

src_env:
  robot: Panda
  controller_type: JOINT_VELOCITY
  robot_obs_keys:
    - robot0_joint_pos_cos
    - robot0_joint_pos_sin
  obj_obs_keys:
    - target_to_robot0_eef_pos
    # - target_pos

tgt_env:
  robot: Sawyer
  controller_type: JOINT_VELOCITY
  robot_obs_keys:
    - robot0_joint_pos_cos
    - robot0_joint_pos_sin
  obj_obs_keys:
    - target_to_robot0_eef_pos
    # - target_pos

# 条件 c（可多键拼接），此处仅使用目标相对位姿
cond_keys:
  - robot0_eef_pos
  - target_to_robot0_eef_pos

lat_obs_dim: 6
lat_act_dim: 6

src_model_dir:  models/6/Reach/23-34-38_Reach_Panda_JOINT_VELOCITY_BC/models/step_2000000

flowmatching:
  # 公共 path（FM 路径）定义一个锚点（仅记录语义，不参与训练权重）
  path_defaults: &fm_default
    type: flowmatching
    path: linear
    t_sampling: beta_2_1
    prior_endpoint: standard_normal

  stats_passes: 2000
  latent_passes: 2000

  latent:
    n_layers: 4
    hidden_dim: 1024
    steps: 300000
    batch_size: 16384
    lr: 3.0e-4
    ema_decay: 0.999
    path: *fm_default

  src_act:
    n_layers: 4
    hidden_dim: 1024
    steps: 300000
    batch_size: 16384
    lr: 3.0e-4
    ema_decay: 0.999
    path: *fm_default

  tgt_act:
    n_layers: 4
    hidden_dim: 1024
    steps: 300000
    batch_size: 16384
    lr: 3.0e-4
    ema_decay: 0.999
    path: *fm_default

  # 训练/验证/保存
  val_ratio: 0.1
  log_freq: 1000
  save_interval: 20000
  suffix: flowmatching_pretrain_act